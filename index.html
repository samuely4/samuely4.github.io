<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
</head>
<body>
    <header class="text-center py-5" style="background-color:#2f4357;">
        <div class="container">
            <h1 class="font-weight-light text-white">New York City</h1>
            <h3 class="font-weight-light text-white">During COVID-19 Pandemic</h3>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row py-5 pl-5 pr-5">
            <div class="col-md-8">
                <h2>Introduction</h2>
                <h5>
                    The first case relating to the COVID-19 pandemic was confirmed in New York City in March 2020 by a woman who had recently traveled to New York City from Iran,
                    a country seriously affected already by the COVID-19 pandemic at the time. Nearly a month later,
                    the metropolitan area was the worst-affected area in the country, with its medical infrastructure overtaxed.
                    By April, the city had more confirmed coronavirus cases than China, the U.K.,
                    or Iran, and by May, had more cases than any country other than the United States.
                    On March 20, the governor's office issued an executive order closing down non-essential businesses.
                    The city's public transportation system remained open but experienced crowding due to reduced transit service and an increase of homeless persons seeking shelter on the subway.
                    By April, hundreds of thousands of New Yorkers were out of work with lost tax revenues estimated to run into the billions.
                    Low income jobs in the retail, transportation and restaurant sectors are especially affected.
                    The drop in income, sales tax and tourism revenues including hotel tax revenue may have cost the city up to $10 billion.
                    Mayor Bill de Blasio has said the city's unemployment system collapsed following a surge in claims and it will require federal assistance to maintain basic services.
                    The ongoing pandemic is the deadliest disaster by death toll in the history of New York City. The following is an interactive slideshow outlining the most difficult 4 months
                    (March, April, May, June) of 2020 during which New Yorkers fought the virus bravely.
                </h5>
            </div>
            <div class="col-md-4">
                <img src="Images/NYCCOVID.jpg" class="img-fluid" alt="NYC During COVID-19 Pandemic">
            </div>
        </div>
        <hr />
        <div class="row py-5 pl-5 pr-5">
            <div class="col-md-12 d-flex justify-content-around">
                <button class="btn btn-secondary btn-lg" value=3 onclick="showChart(this)">March</button>
                <button class="btn btn-secondary btn-lg" value=34 onclick="showChart(this)">March-April</button>
                <button class="btn btn-secondary btn-lg" value=35 onclick="showChart(this)">March-May</button>
                <button class="btn btn-secondary btn-lg" value=36 onclick="showChart(this)">March-June</button>
            </div>
        </div>
        <hr />
        <div class="row py-5 pl-5 pr-5">
            <div class="col-md-12">
                <svg width="1390" height="500" id="NYCCOVIDBar">
                    <g></g>
                    <text id="month" x=51.95% y=13% font-family="sans-serif" font-size="20px" fill=black text-anchor="middle" alignment-baseline="central"></text>
                    <image id="annotation" xlink:href="Images/NYC_logo.png" x=606 y=-100 height="40px" width="40px">
                    </image>
                </svg>
            </div>
        </div>
        <div class="row py-5 pl-5 pr-5" id="monthStory">
            <div class="col-md-12">
                <img id="monthImg" src="" alt="NYC COVID-19 Month StoryLine" class="img-fluid">
                <p><span id="monthDev"></span></p>
            </div>
        </div>
    </div>





    <script type="text/javascript" src="d3/d3.min.js"></script>
    <script type="text/javascript" src="js/jquery-3.2.1.slim.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>


    <script>

        document.getElementById("NYCCOVIDBar").style.display = "none";
        document.getElementById("monthDev").style.display = "none";

        function hideChart() {
            document.getElementById("NYCCOVIDBar").style.display = "none";
            document.getElementById("monthDev").style.display = "none";
            document.getElementById("monthImg").style.display = "none";

            d3.select("svg").select("g").selectAll(".chart").data([]).exit().remove()

            d3.select("svg").select("image").attr("x", 606).attr("y", -100)
        }

        function showChart(monthVal) {
            document.getElementById("NYCCOVIDBar").style.display = "block";
            document.getElementById("monthDev").style.display = "block";
            document.getElementById("monthImg").style.display = "block";


            if (monthVal.value == 3) {
                monthText = "paragraph for each month";
                monthShow = "March";
            }
            else if (monthVal.value == 34) {
                monthText = "paragraph for each month";
                monthShow = "March - April";
            }
            else if (monthVal.value == 35) {
                monthText = "paragraph for each month";
                monthShow = "March - May";
            }
            else if (monthVal.value == 36) {
                monthText = "paragraph for each month";
                monthShow = "March - June";
            }

            document.getElementById("monthDev").innerHTML = monthText;
            document.getElementById("month").innerHTML = monthShow;
            var svg = d3.select("svg");
            var margin = { top: 60, right: 100, bottom: 40, left: 40 };
            var width = +svg.attr("width") - margin.left - margin.right;
            var height = +svg.attr("height") - margin.top - margin.bottom;
            var parseTime = d3.timeParse("%m/%d/%Y");
            var x = d3.scaleTime().range([width / 122 / 2, width - width / 122 / 2]);
            var y = d3.scaleLinear().domain([0, 6500]).range([height, 0]);

            NYC_data = "https://raw.githubusercontent.com/samuely4/samuely4.github.io/master/data/NYCData.csv"
            d3.csv(NYC_data, function (d) {
                return {
                    Date_of_Interest : d.Date,
                    caseCount : +d.Case_Count,
                    deathCount : +d.Death_Count,
                    HospCount : +d.Hospitalized_Count,
                    percPositive : +d.Percent_Positive,
                    posTests : +d.Positive_Tests,
                    totTests : +d.Total_Tests
                };
            }).then(function (data, indx) {
                data.forEach(function (d) {
                    d.Date_of_Interest = parseTime(d.Date_of_Interest);
                });
                //console.log(data)
                x.domain(d3.extent(data, function (d) { return d.Date_of_Interest; }))
                var g = svg.select("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                
                const axis = d3.axisBottom(x).ticks(data.length / 2).tickFormat(d3.timeFormat("%b %d"));
                
                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(axis)
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", "rotate(-65)");;

                g.append("g")
                 .call(d3.axisLeft(y).ticks(13));

                var Recs = 0
                if (monthVal.value == 3) {
                    Recs = 31;
                }
                else if (monthVal.value == 34) {
                    Recs = 61;
                }
                else if (monthVal.value == 35) {
                    Recs = 92;
                }
                else if (monthVal.value == 36) {
                    Recs = 122;
                }

                //console.log(Recs)

                 g.selectAll(".chart")
                    .data(data.slice(0, Recs))
                    .enter().append("rect")
                    .attr("x", function (d) { return x(d.Date_of_Interest) - (width / data.length) / 2; })
                    .attr("y", function (d) { return y(0); })
                    .transition().duration(1000)
                    .attr("y", function (d) { return y(d.caseCount); })
                    .attr("height", function (d) { return height - y(d.caseCount); })
                    .attr("width", width / (data.length + 18))

            });
        }

        function tooltipcontent(d) {
            if (d.caseCount > 0) { monthShow += "<br> " + d.caseCount; }
            if (d.deathCount > 0) { monthShow += "<br> " + d.deathCount; }
            if (d.HospCount > 0) { monthShow += "<br> " + d.HospCount; }
            if (d.percPositive > 0) { monthShow += "<br> " + d.percPositive; }
            if (d.posTests > 0) { monthShow += "<br> " + d.posTests; }
            if (d.totTests > 0) { monthShow += "<br> " + d.totTests; }
            return monthShow
        }

    </script>

</body>
</html>